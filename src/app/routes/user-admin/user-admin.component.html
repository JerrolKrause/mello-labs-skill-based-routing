<div id="user-admin" class="container-fluid" *ngIf="{ state: usersState$ | async, users: users$ | async } as routeData">

	<div class="card mb-3">
		<div class="card-header p-2">

			<div class="float-right">
				<!-- Add User -->
				<launch-modal classes="btn btn-primary btn-sm mr-2" modal="UserAddModalComponent" size="xl">
					<i class="fa fa-user-plus" aria-hidden="true"></i> Add User
				</launch-modal>
				<!-- Refresh users -->
				<button class="btn btn-icon btn-sm mr-2" (click)="usersRefresh()" [disabled]="routeData?.state?.loading">
					<i class="fa fa-refresh"></i>
				</button>
			</div>

			<!-- Pod Change -->
			<form class="form-inline mr-2 d-inline-block">
				<label>
					<select class="form-control form-control-sm" (change)="podChange($event)">
						<option *ngFor="let pod of pods">{{pod}}</option>
					</select>
				</label>
			</form>

			<!-- Filter datatable -->
			<form class="form-inline mr-2 d-inline-block">
				<label class="icon search" style="position:relative;">
					<input class="form-control form-control-sm filterSearch" type="text" name="userSearchTerm" placeholder="Search users" [(ngModel)]="userSearchTerm" />
					<a (click)="userSearchTerm = null" *ngIf="userSearchTerm" style="position:absolute;right: 10px;"><i class="fa fa-remove"></i></a>
				</label>
			</form>

		</div>
	</div>

	<api-state [state]="routeData?.state" [toaster]="true" [showSuccess]="false" *ngIf="routeData?.state">
		<!-- Accordion  activeIds="ngb-panel-0"  -->
		<ngb-accordion #acc="ngbAccordion" activeIds="ngb-panel-0" class="accordion-md" *ngIf="(users | filter: userSearchTerm:'name' | debounce) as usersFiltered">
			<ngb-panel *ngFor="let user of usersFiltered">
				<ng-template ngbPanelTitle>
					<strong>{{user.name}}</strong>
					<div class="float-right">
						<span class="badge badge-default" style="font-weight: normal;min-width:130px;">Max Capacity: <strong>{{user.capacity}}</strong></span>
					</div>
				</ng-template>
				<ng-template ngbPanelContent>
					<div class="p-3">
						<!-- User Tabs-->
						<ngb-tabset>
							<ngb-tab>
								<ng-template ngbTabTitle><i aria-hidden="true" class="fa fa-cube"></i> Assignment Rules</ng-template>
								<ng-template ngbTabContent>
									<assignment-rules [user]="user"></assignment-rules>
								</ng-template>
							</ngb-tab>
							<ngb-tab>
								<ng-template ngbTabTitle><i class="fa fa-calendar" aria-hidden="true"></i> PTO Calendar</ng-template>
								<ng-template ngbTabContent>
									<!-- PTO Calendar-->
									<pto-calendar></pto-calendar>
								</ng-template>
							</ngb-tab>
						</ngb-tabset>
					</div>
				</ng-template>
			</ngb-panel>
		</ngb-accordion>
	</api-state>

</div>

